C   06/10/83 603081617  MEMBER NAME  LINOPT   (SEPT95.S) M  FORTRAN
      SUBROUTINE LINOPT(E0,IE0,U0,CIR)
C
C
C===========LINEAR MACHINE FUNCTIONS AROUND THE RING.=================
C
C
      IMPLICIT REAL*8(A-H,O-Z)
C
      DIMENSION TREV(7,7),TREV77(7,7),TEMP(7,7),TM7(7,7)
      DIMENSION TM6A(6,6),TM6B(6,6),WR(6),WI(6)
      DIMENSION TRIN6(6,6),RR6(6),RI6(6),VR6(6,6),VI6(6,6)
C      DIMENSION INTGE6(6),WW6(6,6),ZZ(6,6)
      PARAMETER( LWORK=64*6 )   ! now needed for  F02EBF: MV/09.10.2007
      DIMENSION WORK(LWORK)     ! now needed for  F02EBF: MV/09.10.2007
      DIMENSION WW6(6,6),ZZ(6,6)
CDB      REAL*8 NUX,NUY,MUX,MUY
      REAL*8 MUX,MUY
CDB   Real DNAME/'D'/,IP/'IP'/,PU/'PU'/
      DATA IH/0/,IV/0/,IPU/0/
C
C
      INCLUDE "cdesy2.for"
      INCLUDE "cnlist.for"
      INCLUDE "clatic.for"
C      INCLUDE "cbeta.for"
      INCLUDE "csol.for"
      INCLUDE "csex.for"
      INCLUDE "cintpt.for"
C
C=====SYMPLECTIC UNIT MATRIX  (7X7 VERSION)
      DIMENSION SYM(7,7)
      DATA SYM/49*0.D0/
      SYM(1,2)=-1.D0
      SYM(2,1)= 1.D0
      SYM(3,4)=-1.D0
      SYM(4,3)= 1.D0
      SYM(5,6)=-1.D0
      SYM(6,5)= 1.D0
      SYM(7,7)= 1.D0
C
C
      PI=3.1415926535897932D0
C
      IF(IE0.NE.1)GO TO 18
      IT=ITYPE(1)
C      CALL UCOPY(TMAT(1,1,IT),TREV,98)
C      CALL UCOPY(TMAT(1,1,IT),TREV77,98)
      TREV   =  TMAT(1:7,1:7,IT) 
      TREV77 =  TREV


      IF(IPTBET.EQ.1)WRITE(53,902)
C
C
      DO 42 II=1,NELEM
      IF(II.EQ.1) GO TO 15
      JTY=ITYPE(II-1)
      JID=ID(JTY)
      IF(JID.EQ.99)GO TO 163
      BXTEMP=BETAX
      BYTEMP=BETAY
      AXTEMP=ALPHAX
      AYTEMP=ALPHAY
      EXTEMP=ETAX
      GO TO(134,134,134,136, 16,1366,1366,136,134, 136,134,134,134,137,
     +                                                 134,134,134),JID
C=====Similarity trans. to get the 1 turn matrix for other elements.
C=====By using 1 turn matrices consistently it is much simpler to
C=====extract Twiss parameters.
C=====Get Twisses at end of element (II-1)
C=====Weak solenoids are treated as drift-otherwise use type 14 elements
C     NB THE NEXT FEW LINES ONLY WORK FOR SINGLE ELEMENTS WHERE THE
C     (1,1)=(2,2) etc. OTHERWISE USE STUFF AFTER 137.
  134 DO 11 I=1,7
      DO 11 J=1,7
      TM7(I,J)=TMAT(I,J,JTY)
   11 IF(I.NE.J)TM7(I,J)=-TM7(I,J)
C=====FOR DIPS+CF.,LOOP ABOVE DOES NOT GIVE INVERSE,NEED EXTRA MODS.
      TM7(1,6)=TMAT(1,6,JTY)
      TM7(5,2)=TMAT(5,2,JTY)
      TM7(3,6)=TMAT(3,6,JTY)
      TM7(5,4)=TMAT(5,4,JTY)
      GO TO 138
C=====COMPLICATED NOLIN. OR COUPLED ELEMENTS IGNORED HERE.
  136 CALL UNIT(7,TM7)
      IF(NAME(JTY)(1:2).NE.'RQ')THEN
      TM7(1,2)=-YY(JTY)
      TM7(3,4)=-YY(JTY)
      ENDIF
      GO TO 138
 1366 CALL UNIT(7,TM7)
      GO TO 138
  137 CALL UNIT(7,TM7)
      TM7(1,1)= TMAT(2,2,JTY)
      TM7(1,2)=-TMAT(1,2,JTY)
      TM7(2,1)=-TMAT(2,1,JTY)
      TM7(2,2)= TMAT(1,1,JTY)
      TM7(3,3)= TMAT(4,4,JTY)
      TM7(3,4)=-TMAT(3,4,JTY)
      TM7(4,3)=-TMAT(4,3,JTY)
      TM7(4,4)= TMAT(3,3,JTY)
  138 CALL JAM777(TEMP,TREV,TM7)
      GO TO(174,174,174,176, 16,1766,1766,176,174, 176,174,174,174,174,
     +                                                 174,174,174),JID
C  174 CALL UCOPY(TMAT(1,1,JTY),TM7,98)
  174 TM7   =  TMAT(1:7,1:7,JTY)
      GO TO 178
  176 CALL UNIT(7,TM7)
      IF(NAME(JTY)(1:2).NE.'RQ')THEN
      TM7(1,2)=YY(JTY)
      TM7(3,4)=YY(JTY)
      ENDIF
      GO TO 178
 1766 CALL UNIT(7,TM7)
  178 CALL JAM777(TREV,TM7,TEMP)
      GOTO 16
C
C=====CALCULATE THE UNPERTURBED 1 TURN MATRIX BASED AT THE IST ELEMENT.
C=====N.B. 'CELL' IS JUST SKIPPED AND THE FULL 1 TURN IS CALCULATED.
   15 DO 131 I=2,NELEM
      ITY=ITYPE(I)
      IID=ID(ITY)
      GO TO(130,130,130,132,130,1322,1322,132,130, 132,130,130,130,130,
     +                                                 130,130,130),IID
      IF(IID.EQ.99)GO TO 131
C  130 CALL UCOPY(TMAT(1,1,ITY),TEMP,98)
  130 TEMP  =  TMAT(1:7,1:7,ITY)
      GOTO 133
  132 CALL UNIT(7,TEMP)
      IF(NAME(ITY)(1:2).NE.'RQ')THEN
      TEMP(1,2)=YY(ITY)
      TEMP(3,4)=YY(ITY)
      ENDIF
      GOTO 133
 1322 CALL UNIT(7,TEMP)
  133 CONTINUE
      IF(IID.NE.5)CALL JAM777(TREV,TEMP,TREV)
      CALL JAM777(TREV77,TEMP,TREV77)
  131 CONTINUE
C
C
C
C
C
C
C
C
C
C
C
C
C
      MUX=DACOS(0.5D0*(TREV(1,1)+TREV(2,2)))
      IF(TREV(1,2) .LT. 0.)MUX=2.D0*PI-MUX
      MUY=DACOS(0.5D0*(TREV(3,3)+TREV(4,4)))
      IF(TREV(3,4) .LT. 0.)MUY=2.D0*PI-MUY

      PSIX=0.
      PSIY=0.
      S=0.
      IT=0
      CHX0=0.
      CHX1=0.
      CHY0=0.
      CHY1=0.
      SEX11=0.D0
      SEX12=0.D0
      SEX21=0.D0
      SEX22=0.D0
      SEXL11=0.D0
      SEXL12=0.D0
      SEXL21=0.D0
      SEXL22=0.D0
      NSEX1=0
      NSEX2=0
   16 BETAX=TREV(1,2)/DSIN(MUX)
      BETAY=TREV(3,4)/DSIN(MUY)
      ALPHAX=(TREV(1,1)-TREV(2,2))/(2.*DSIN(MUX))
      ALPHAY=(TREV(3,3)-TREV(4,4))/(2.*DSIN(MUY))
      DDD=(TREV(1,1)-1.D0)*(TREV(2,2)-1.D0)-TREV(2,1)*TREV(1,2)
      ETAX=(-TREV(1,6)*(TREV(2,2)-1.D0)+TREV(2,6)*TREV(1,2))/DDD
      ETAXP=(TREV(2,1)*TREV(1,6)-(TREV(1,1)-1.D0)*TREV(2,6))/DDD
      DDD=(TREV(3,3)-1.D0)*(TREV(4,4)-1.D0)-TREV(3,4)*TREV(4,3)
      ETAY=(-TREV(3,6)*(TREV(4,4)-1.D0)+TREV(4,6)*TREV(3,4))/DDD
      ETAYP=(TREV(4,3)*TREV(3,6)-(TREV(3,3)-1.D0)*TREV(4,6))/DDD
 
      IF(II.EQ.1)BETAY0=BETAY
      IF(II.EQ.1)BETAX0=BETAX
      IF(II.EQ.1) GO TO 21
      XXY=1.D0
      IF(JID.EQ.1)XY=XX(JTY)
      IF(JID.EQ.5.OR.JID.EQ.6.OR.JID.EQ.7.OR.JID.EQ.17)XY=0.D0
      IF(JID.EQ.8.OR.JID.EQ.10)XY=YY(JTY)
      IF(JID.EQ.2.OR.JID.EQ.3.OR.JID.EQ.4.OR.JID.EQ.9.OR.JID.EQ.14.OR.
     +                          JID.EQ.15.OR.JID.EQ.16)XY=TMAT(1,2,JTY)
      IF(JID.EQ.2.OR.JID.EQ.3.OR.JID.EQ.4.OR.JID.EQ.9.OR.JID.EQ.14.OR.
     +                         JID.EQ.15.OR.JID.EQ.16)XXY=TMAT(1,1,JTY)
C=====PHASE SHIFTS--GET DODGY RESULTS FROM THIS METHOD IF HAVE COUPLING
C=====INSIDE TYPE 14 BLACK BOX? NO! ITS OK
      SINPSI=XY/DSQRT(BETAX*BXTEMP)
      COSPSI=XXY*DSQRT(BXTEMP/BETAX)-AXTEMP*SINPSI
      DPSI=DATAN2(SINPSI,COSPSI)
      IF(SINPSI.LT.0.D0)DPSI=2.D0*PI+DPSI
      DPSIX=DPSI/2./PI
      SINX=SINPSI
      PSIX=PSIX+DPSI/2.D0/PI
      IF(JID.EQ.2.OR.JID.EQ.3.OR.JID.EQ.4.OR.JID.EQ.9.OR.JID.EQ.14.OR.
     +                          JID.EQ.15.OR.JID.EQ.16)XY=TMAT(3,4,JTY)
      IF(JID.EQ.2.OR.JID.EQ.3.OR.JID.EQ.4.OR.JID.EQ.9.OR.JID.EQ.14.OR.
     +                         JID.EQ.15.OR.JID.EQ.16)XXY=TMAT(3,3,JTY)
      SINPSI=XY/DSQRT(BETAY*BYTEMP)
      COSPSI=XXY*DSQRT(BYTEMP/BETAY)-AYTEMP*SINPSI
      DPSI=DATAN2(SINPSI,COSPSI)
      IF(SINPSI.LT.0.D0)DPSI=2.D0*PI+DPSI
      DPSIY=DPSI/2./PI
      SINY=SINPSI
      PSIY=PSIY+DPSI/2.D0/PI
C
      IF(JID.EQ.5.OR.JID.EQ.6.OR.JID.EQ.7.OR.
     +  (JID.EQ.3.AND.NAME(JTY)(1:2).EQ.'CQ').OR.
     +  (JID.EQ.4.AND.NAME(JTY)(1:2).EQ.'RQ').OR.
     +  (JID.EQ.3.AND.NAME(JTY)(1:1).EQ.'E'))GO TO 777
       S=S+YY(JTY)
  777  CONTINUE

      ISX=ISEXFM(JTY)
C=====PROJECT BACKWARDS TO CENTRE OF ELEMENT: NOT GOOD BUT BETTER THAN
C=====NICHTS!  (THE TWISSES ARE FOR THE ENDS OF THE ELEMENTS)
C     BX=BETAX+2.D0*ALPHAX*(YY(JTY)*0.5D0)
C     BY=BETAY+2.D0*ALPHAY*(YY(JTY)*0.5D0)
C     DETAX=ETAX-ETAXP*YY(JTY)*0.5D0
      BX=(BETAX+BXTEMP)*0.5D0
      BY=(BETAY+BYTEMP)*0.5D0
      DETAX=(ETAX+EXTEMP)*0.5D0
      IF(JID.EQ.8)CHX1=CHX1+BX  *DETAX*XX(JTY)*NINS/(4.*PI)
      IF(JID.EQ.8)CHY1=CHY1-BY  *DETAX*XX(JTY)*NINS/(4.*PI)
      IF(JID.EQ.8.AND.ISX.EQ.1)SEX11=SEX11+BX*DETAX*NINS/(4.*PI)
      IF(JID.EQ.8.AND.ISX.EQ.2)SEX12=SEX12+BX*DETAX*NINS/(4.*PI)
      IF(JID.EQ.8.AND.ISX.EQ.1)SEX21=SEX21-BY*DETAX*NINS/(4.*PI)
      IF(JID.EQ.8.AND.ISX.EQ.2)SEX22=SEX22-BY*DETAX*NINS/(4.*PI)
      IF(JID.EQ.8.AND.ISX.EQ.1)NSEX1=NSEX1+1
      IF(JID.EQ.8.AND.ISX.EQ.2)NSEX2=NSEX2+1
      IF(JID.EQ.8.AND.ISX.EQ.1)SEXL11=SEX11*YY(JTY)
      IF(JID.EQ.8.AND.ISX.EQ.2)SEXL12=SEX12*YY(JTY)
      IF(JID.EQ.8.AND.ISX.EQ.1)SEXL21=SEX21*YY(JTY)
      IF(JID.EQ.8.AND.ISX.EQ.2)SEXL22=SEX22*YY(JTY)
      LQUAD=0
      IF(JID.EQ.3.AND.LQUAD.EQ.0)CHX0=CHX0-BX   *XX(JTY)*NINS/(4.*PI)
      IF(JID.EQ.3.AND.LQUAD.EQ.0)CHY0=CHY0+BY   *XX(JTY)*NINS/(4.*PI)
      IF(JID.EQ.15)CHX0=CHX0-BX   *X2(JTY)*NINS/(4.*PI)
      IF(JID.EQ.15)CHY0=CHY0+BY   *X2(JTY)*NINS/(4.*PI)
      IF(JID.EQ.16)CHX0=CHX0-BX   *X2(JTY)*NINS/(4.*PI)
      IF(JID.EQ.16)CHY0=CHY0+BY   *X2(JTY)*NINS/(4.*PI)
C
C
   21 CONTINUE
C      WRITE(10)NAME(ITYPE(II-0)),S,BETAX,BETAY,ALPHAX,
C     +   ALPHAY,ETAX,ETAXP,ETAY,ETAYP,PSIX,PSIY,NAME(ITYPE(II-0))
      IF(S.GT.25000.0) GOTO 160
      IF(NAME(ITYPE(II-0))(1:2).EQ.'IP')
     + WRITE(53,93)NAME(ITYPE(II-0)),S,BETAX,BETAY,ALPHAX,
     +    ALPHAY,ETAX,ETAXP,ETAY,ETAYP,PSIX,PSIY,NAME(ITYPE(II-0))
C      IF(II.EQ.1)THEN
C      IF(IPTBET.EQ.1)WRITE(53,93)NAME(ITYPE(II-0)),S,BETAX,BETAY,ALPHAX,
C     +    ALPHAY,ETAX,ETAXP,ETAY,ETAYP,PSIX,PSIY,NAME(ITYPE(II-0))
      IF(II.GT.1.AND.NAME(ITYPE(II-1)).NE.'DRIFT') THEN
      IF(IPTBET.EQ.1)WRITE(53,93)NAME(ITYPE(II-1)),S,BETAX,BETAY,ALPHAX,
     +    ALPHAY,ETAX,ETAXP,ETAY,ETAYP,PSIX,PSIY,NAME(ITYPE(II-1))
      ENDIF

C=====28 July 2008: what was this?
C      IF(NAME(ITYPE(II-0))(1:2).EQ.'IP')THEN
C      WRITE(53,93)NAME(ITYPE(II-0)),S,BETAX,BETAY,ALPHAX,
C     +    ALPHAY,ETAX,ETAXP,ETAY,ETAYP,PSIX,PSIY,NAME(ITYPE(II-0))
C      ELSEIF(NAME(ITYPE(II-1))(1:5).NE.'DRIFT') THEN
C      IF(IPTBET.EQ.1)WRITE(53,93)NAME(ITYPE(II-1)),S,BETAX,BETAY,ALPHAX,
C     +    ALPHAY,ETAX,ETAXP,ETAY,ETAYP,PSIX,PSIY,NAME(ITYPE(II-1))
C      ENDIF
   93 FORMAT(1X,A8,11F10.4,1X,A4)
 
  160 CONTINUE
C
C
C=====FILL ARRAYS FOR DESY2. AVOID EXCEEDING 24 KICKERS WHATEVER MACHINE
      IF(JID.EQ.6.AND.JTY.LE.24)IH=IH+1
      IF(IH.GT.24)IH=24
      IF(JID.EQ.6.AND.JTY.LE.24)BDX(1,IH)=DSQRT(BETAX)
      IF(JID.EQ.6.AND.JTY.LE.24)BDX(2,IH)=PSIX*2.*PI
      IF(JID.EQ.7.AND.JTY.GT.24.AND.JTY.LE.48)IV=IV+1
      IF(IV.GT.24)IV=24
      IF(JID.EQ.7.AND.JTY.GT.24.AND.JTY.LE.48)BDZ(1,IV)=DSQRT(BETAY)
      IF(JID.EQ.7.AND.JTY.GT.24.AND.JTY.LE.48)BDZ(2,IV)=PSIY*2.*PI
      IF(NAME(ITYPE(II-0)).EQ.'PU')IPU=IPU+1
      IF(IPU.GT.24)IPU=24
      IF(NAME(ITYPE(II-0)).EQ.'PU')BDX(3,IPU)=DSQRT(BETAX)
      IF(NAME(ITYPE(II-0)).EQ.'PU')BDX(4,IPU)=PSIX*2.*PI
      IF(NAME(ITYPE(II-0)).EQ.'PU')BDZ(3,IPU)=DSQRT(BETAY)
      IF(NAME(ITYPE(II-0)).EQ.'PU')BDZ(4,IPU)=PSIY*2.*PI
      GO TO 42
C1600 WRITE(53,1601)IH,IV,IPU
C1601 FORMAT(' ','TOO MANY KICKER/MONITORS ',3I10)
C     STOP
C
C
C
C
C
C
C=====END OF BETA FUNCTION LOOP
   42 CONTINUE
C
C      IF(1.EQ.1)STOP
C
C
C=====SUMMARISE THE TWISS PARAMETERS
  163 NUX=PSIX*NINS
      NUY=PSIY*NINS
      CIR=S*NINS

      ALPHA=-(TREV(5,6)+TREV(5,1)*ETAX+TREV(5,2)*ETAXP+TREV(5,3)*
     +                                         ETAY+TREV(5,4)*ETAYP)/CIR
C=====Although this is derived rigorously in Chao, it is almost obvious:
C     we need the length change due to a unit energy change. So we just
C     use the 'length row' of the 6x6 matrix and the dependence of
C     transverse position (etc) on energy.


 

      CHX=CHX0+CHX1
      CHY=CHY0+CHY1
C=====Kill the next stuff. It's for a 2 family HERA corection anyway.
C      EM1=-1./(SEX11*SEX22-SEX12*SEX21)*( SEX22*CHX0-SEX12*CHY0)
C      EM2=-1./(SEX11*SEX22-SEX12*SEX21)*(-SEX21*CHX0+SEX11*CHY0)
C
C
C=====CALCULATE TRAJECTORIES
C     CALL TRAJEC
C
   18 WRITE(53,904)NELEM,NUX,NUY,BETAX0,BETAY0,E0,CIR,ALPHA,U0,CHX0,
     +    CHX1,CHX,CHY0,CHY1,CHY,EM1,EM2,SEXL11,SEXL12,SEXL21,SEXL22
      IF(IE0.NE.1)RETURN

C
C
C
C
C
C
C
C
C
C
C
C=====SUMMARISE UNPERTURBED 6X6 CALCULATION
      DO 14 I164=1,6
      DO 14 J164=1,6
   14 TM6B(I164,J164)=TREV77(I164,J164)
CDB   CALL EIV6(TM6B,TM6A,WR,WI,IERRO)
CDB   IERR0=0
CDB   IF(IERRO .NE. 0) GOTO 9999
C=====USE THE NAG ROUTINE. THIS IS MORE ROBUST THAN EIV6.
C      CALL UCOPY(TM6B,TRIN6,72)
      TRIN6  =  TM6B
      IFAIL=0
C      CALL F02AGF(TRIN6,6,6,RR6,RI6,VR6,6,VI6,6,INTGE6,IFAIL)
      CALL F02EBF('V',6,TRIN6,6,RR6,RI6,VR6,6,VI6,6,WORK,LWORK,IFAIL) ! <<replmnt
      IF(IFAIL.NE.0)GO TO 9999
C=====WRITE OUT F02AGF RESULTS
C     WRITE(53,9266)
C9266 FORMAT(' ','NOW THE F02AGF RESULTS: 8X8')
      DO 2822 I=1,3
      IT=2*I-1
      DO 2833 J=1,6
      ZZ(J,IT  )=VR6(J,IT)
 2833 ZZ(J,IT+1)=VI6(J,IT)
 2822 CONTINUE
      DO 2844 I=1,6
      WR(I)=RR6(I)
 2844 WI(I)=RI6(I)
C      CALL UCOPY(ZZ,TM6A,72)
      TM6A = ZZ
C
C
      CALL RENORM(TM6A,6,WR,WI)
C
C
      IF(IE0.GT.1)GO TO 951
      WRITE(53,953)
      DO 35 I=1,6
   35 WRITE(53,91)(TM6B(I,J),J=1,6)
   91 FORMAT(6F12.5)
      CALL SYMP6(TM6B)
      WRITE(53,952)
      DO 38 I=1,6
      IF(WR(I).GT.1.D0)WR(I)=1.D0
C     TUN=DACOS(WR(I))/(2.*PI)
      TUN=DATAN2(WI(I),WR(I))/(2.*PI)
   38 WRITE(53,096)WR(I),WI(I),(TM6A(J,I),J=1,6),TUN
   96 FORMAT(T12,F12.5,T27,F12.5,T41,'(',6F11.5,')',F15.8)
  951 CONTINUE
C
C
C      IF(1.EQ.1)STOP
C
C
      RETURN
 9999 WRITE(53,92)
   92 FORMAT(' ERROR IN EIGEN VALUE ROUTINE')
      STOP
C
C
C
C
C
  902 FORMAT(1H1,1X,'UNPERTURBED MACHINE FUNCTIONS AT END OF EA',
     >    'CH ELEMENT',///,1X,'NAME',T14,'S______',T25,'BETAX___',T35,
     >    'BETAY___',T45,'ALPHAX__',T55,'ALPHAY__',T65,'ETAX____'
     >    ,T75,'ETAXP___',T85,'ETAY____',T95,'ETAYP___',T105,'PSIX----',
     >    T115,'PSIY----',/)
  904 FORMAT(1H1,T4,'UNPERTURBED MACHINE PARAMETERS:',/,T5,'TOTAL ',
     +    '# OF BEAM-LINE ELEMENTS=',I6,/,T5,'NUX=',F9.5,T23,'NUY=',
     +    F9.5,/,T5,'BETAX*=',F9.4,' M',/,T5,
     +    'BETAY*=',F9.4,' M',/,T5,'BEAM ENERGY=',F9.4,' GEV',/,T5,
     +    'CIRCUMFERENCE=',F10.4,T30,'M',/,T5,'MOM.COM.FACTOR=',
     +   F9.6,/,T5,'SYN.RAD.LOSS=',F13.6,'  MEV',/,T5,'CHROMATICITIES'
     +    ,':',T25,'NATURAL',T36,'SEX.CONTRIBUTION',T57,'TOTAL',
     +    /,T20,'X',T23,F10.4,T37,F10.4,T54,F10.4,/,T20,'Y',T23,F10.4,
     +    T37,F10.4,T54,F10.4,/,'    REQUIRED 2-FAM SEXT STRENGTHS:',
     +    F14.6,F17.6,' M-2',10X,'SEXT. SUMS:',4F9.3)
  952 FORMAT(///,' UNPERTURBED EIGEN-TUNES AND EIGENVECTORS:',/,T12,
     +    'COS(2*PI*NU)',T27,'SIN(2*PI*NU)',T42,'EIGENVECTORS',T112,'
     +TUNES')
  953 FORMAT(///,'   UNPERTURBED TOTAL TRANSFER AROUND THE 1-ST ELEMENT
     +(WITH NON-ZERO CAVITY VOLTAGE)')
C
C
C
C     TM7(6,3)=0.D0
C     TM7(4,5)=0.D0
C     WRITE(53,192)
C 192 FORMAT(' ',//)
C=====GET INVERSE USING SYMPLECTIC PROPERTIES.
C     CALL JAM777(TM7,TM7,SYM)
C     CALL JAM777(TM7,SYM,TM7)
C     DO 435 I=1,7
C 435 WRITE(53,991)(TM7(I,J),J=1,7)
C     WRITE(53,192)
C     WRITE(53,192)
      END
