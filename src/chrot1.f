C   05/09/85 609111110  MEMBER NAME  CHROTN   (S)           FORTRAN
      SUBROUTINE CHROTN(E0,NTY,ICALL)
C
C
C=====ROUTINE TO RESET THE E3 ROTATORS FOR USE AT A DIFFERENT ENERGY.
C=====PARAMETERS FROM J.BUON'S 'ROTATOR' FILE .
C=====SEE END OF MEMBER 'ROTATOR' FOR DETAILS. ANGLES ARE READ IN RADS.
C
C     ICALL=0: READ FILE
C     ICALL=1: CHANGE ENERGY,FIND NEARBY DATA LINES.
C     ICALL=2: SET MAGNETS
C
      IMPLICIT REAL*8 (A-H,O-Z)
      COMMON/CROT/H4(1500),V3(1500),H3(1500),V2(1500),H2(1500),V1(1500),
     +            H1(1500),EROT(1500),FC,NL,JL,JL1


#include "cnlist.for"
#include "clatic.for"
#include "csol.for"
C
C
      REAL*8  BRH1/'BRH1'/
      REAL*8  BRH2/'BRH2'/
      REAL*8  BRH3/'BRH3'/
      REAL*8  BRH4/'BRH4'/
      REAL*8  BRH5/'BRH5'/
      REAL*8  BRV1/'BRV1'/
      REAL*8  BRV2/'BRV2'/
      REAL*8  BRV3/'BRV3'/
      REAL*8  BIV1/'BIV1'/
      REAL*8  BIV2/'BIV2'/
      REAL*8  BIV3/'BIV3'/
C
C
      ESET=E0
C     ESET=29.23
      IF(ICALL.GT.0)GO TO 15
C
C=====READ THE ROTATOR DATA FILE.
      NL=1
    9 READ(5,102)V3(NL),H3(NL),V2(NL),H2(NL),V1(NL),H1(NL)
C     WRITE(6,101)NL,V3(NL)
      IF(V3(NL).GT.1.0D5)GO TO 12
      READ(5,102)H4(NL),DNU,EROT(NL)
C     TANGH=H1(NL)+H2(NL)+H3(NL)+H4(NL)
C     TANGV=V1(NL)+V2(NL)+V3(NL)
C     IF(NL.EQ.1)WRITE(105)TANGH,TANGV
C 105 FORMAT(' ',2E13.7)
      NL=NL+1
      GO TO 9
   12 CONTINUE
C     WRITE(6,101)NL,EROT(NL-1)
  101 FORMAT(' ','LAST LINE OF ROTATOR FILE:',I5,3X,E13.7)
  102 FORMAT(6E13.7)
      RETURN
C
C=====USE THE ENERGY ESET TO SELECT THE CORRECT SETTINGS FOR EACH NEW
C=====ROTATOR ENERGY: ROTATOR SETTINGS COME IN ABOUT 20MEV STEPS.
C=====TRY INTERPOLATING TO SEE HOW WELL IT PERFORMS.
   15 IF(ICALL.EQ.2)GO TO 16
C     JL=(ESET+0.001D0-EROT(1))/0.02D0+1
      JL1=1
      DO 20 K=1,NL
      IF(ESET.GT.EROT(K))GO TO 20
      JL1=K
      GO TO 21
   20 CONTINUE
   22 WRITE(6,103)ESET
  103 FORMAT(' ',' ENERGY',F6.2,' OUT OF DESIGN RANGE OF ROTATOR')
      STOP
   21 CONTINUE
      JL=JL1-1
      IF(JL1.EQ.1)GO TO 22
      FC=(ESET-EROT(JL))/(EROT(JL1)-EROT(JL))
      RETURN
C
C
C
C=====FILL IN THE DIPOLE STRENGTHS.
   16 NN=NUNT(NTY)
C     TNAME=NAME

C
      IF(NAME(NTY).EQ.BRV1)XX(NTY)= ((V1(JL1)-V1(JL))*FC+V1(JL))/NN
      IF(NAME(NTY).EQ.BRV2)XX(NTY)= ((V2(JL1)-V2(JL))*FC+V2(JL))/NN
      IF(NAME(NTY).EQ.BRV3)XX(NTY)= ((V3(JL1)-V3(JL))*FC+V3(JL))/NN
      IF(NAME(NTY).EQ.BIV1)XX(NTY)=-((V1(JL1)-V1(JL))*FC+V1(JL))/NN
      IF(NAME(NTY).EQ.BIV2)XX(NTY)=-((V2(JL1)-V2(JL))*FC+V2(JL))/NN
      IF(NAME(NTY).EQ.BIV3)XX(NTY)=-((V3(JL1)-V3(JL))*FC+V3(JL))/NN
      IF(NAME(NTY).EQ.BRH1)XX(NTY)= ((H1(JL1)-H1(JL))*FC+H1(JL))/NN
      IF(NAME(NTY).EQ.BRH2)XX(NTY)= ((H2(JL1)-H2(JL))*FC+H2(JL))/NN
      IF(NAME(NTY).EQ.BRH3)XX(NTY)= ((H3(JL1)-H3(JL))*FC+H3(JL))/NN
      IF(NAME(NTY).EQ.BRH4)XX(NTY)= ((H4(JL1)-H4(JL))*FC+H4(JL))/NN/2.D000001317
      IF(NAME(NTY).EQ.BRH5)XX(NTY)= ((H4(JL1)-H4(JL))*FC+H4(JL))/NN/2.D000001319
C
C
C=====OVERWRITE FIELDS WITH OLD CHROT VALUES AT 29.23GEV FOR TESTING
C     IF(ICALL.EQ.1)RETURN
C     IF(NAME(NTY).EQ.BRV1)XX(NTY)= 0.00130507
C     IF(NAME(NTY).EQ.BIV1)XX(NTY)=-0.00130507
C     IF(NAME(NTY).EQ.BRV2)XX(NTY)=-0.00283711
C     IF(NAME(NTY).EQ.BIV2)XX(NTY)= 0.00283711
C     IF(NAME(NTY).EQ.BRV3)XX(NTY)= 0.00153204
C     IF(NAME(NTY).EQ.BIV3)XX(NTY)=-0.00153204
C     IF(NAME(NTY).EQ.BRH1)XX(NTY)= 0.00063650
C     IF(NAME(NTY).EQ.BRH2)XX(NTY)= 0.00337595
C     IF(NAME(NTY).EQ.BRH3)XX(NTY)=-0.00151988
C     IF(NAME(NTY).EQ.BRH4)XX(NTY)= 0.00044169
C     IF(NAME(NTY).EQ.BRH5)XX(NTY)= 0.00044169
C
C
C     IF(NAME(NTY).EQ.BRV1)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRV2)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRV3)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BIV1)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BIV2)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BIV3)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRH1)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRH2)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRH3)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRH4)WRITE(6,106)NAME(NTY),XX(NTY)
C     IF(NAME(NTY).EQ.BRH5)WRITE(6,106)NAME(NTY),XX(NTY)
C 106 FORMAT(' ',5X,A8,' ANGLE MRADS= ',F20.10)
C
C
      RETURN
      END
